<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Bracket â€” App</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Inter+Tight:wght@500;600;700&display=swap" rel="stylesheet">

<link rel="stylesheet" href="/assets/css/base.css">
<link rel="stylesheet" href="/assets/css/layout.css">
<link rel="stylesheet" href="/assets/css/components.css">
<link rel="stylesheet" href="/assets/css/app.css">
</head>

<body>

<!-- NAV -->
<div id="navbar"></div>

<div class="app-shell">
  <div class="app">

    <!-- TABS -->
    <div class="tabs">
      <div class="tab active" onclick="switchTab('pricing',this)">Pricing</div>
      <div class="tab" onclick="switchTab('scope',this)">Scope</div>
      <div class="tab" onclick="switchTab('playbook',this)">Client Playbook</div>
    </div>

    <!-- CONTENT -->
    <div id="pricing"></div>
    <div id="scope" class="hidden"></div>
    <div id="playbook" class="hidden"></div>

  </div>
</div>

<script>
/* ---------- LOAD PARTIALS (UI ONLY) ---------- */
async function load(id, file){
  const res = await fetch(file);
  document.getElementById(id).innerHTML = await res.text();
}

load("navbar", "/partials/navbar.html");
load("pricing", "/partials/pricing.html");
load("scope", "/partials/scope.html");
load("playbook", "/partials/playbook.html");

/* ---------- TAB LOGIC (UNCHANGED) ---------- */
function switchTab(id, el){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  document.querySelectorAll('#pricing,#scope,#playbook')
    .forEach(c=>c.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

function autoResize(el){
  el.style.height = "auto";
  el.style.height = el.scrollHeight + "px";
}

/* ---------- PRICING (UNCHANGED) ---------- */
async function callPricing(){
  if(!projectType.value || !experience.value || !projectSize.value || !clientClarity.value || !timeline.value){
    alert("Please fill all required fields");
    return;
  }

  const payload = {
    projectType: projectType.value,
    experience: experience.value,
    size: projectSize.value,
    clarity: clientClarity.value,
    timeline: timeline.value,
    context: pricingContext.value
  };

  const res = await fetch("/api/pricing",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify(payload)
  });

  const data = await res.json();
  pricingOutput.value = data.output;
  pricingResult.classList.remove("hidden");
  autoResize(pricingOutput);
}

function resetPricing(){
  projectType.selectedIndex = 0;
  experience.selectedIndex = 0;
  projectSize.selectedIndex = 0;
  clientClarity.selectedIndex = 0;
  timeline.selectedIndex = 0;
  pricingContext.value = "";
  pricingResult.classList.add("hidden");
}

/* ---------- SCOPE (UNCHANGED) ---------- */
function getChecked(id){
  return [...document.querySelectorAll(`#${id} input:checked`)].map(i=>i.value);
}

async function generateScope(){
  if(!workType.value){
    alert("Please select type of work");
    return;
  }

  const payload = {
    workType: workType.value,
    deliverables: getChecked("deliverables"),
    coverage: coverage.value,
    revisions: revisions.value,
    feedback: feedback.value,
    changes: changes.value,
    dependencies: getChecked("dependencies"),
    exclusions: getChecked("exclusions"),
    context: scopeContext.value
  };

  const res = await fetch("/api/scope",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify(payload)
  });

  const data = await res.json();
  scopeOutput.value = data.output;
  scopeResult.classList.remove("hidden");
  autoResize(scopeOutput);
}

function resetScope(){
  document.querySelectorAll('#scope select').forEach(s=>s.selectedIndex=0);
  document.querySelectorAll('#scope textarea').forEach(t=>t.value="");
  document.querySelectorAll('#scope input[type="checkbox"]').forEach(c=>c.checked=false);
  scopeResult.classList.add("hidden");
}

/* ---------- PLAYBOOK (UNCHANGED) ---------- */
async function callAI(type){
  const input = document.getElementById(type+"Input").value.trim();
  if(!input){
    alert("Please enter text");
    return;
  }

  const res = await fetch(`/api/${type}`,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ text: input })
  });

  const data = await res.json();
  const output = document.getElementById(type+"Output");
  output.value = data.output;
  document.getElementById(type+"Result").classList.remove("hidden");
  autoResize(output);
}
</script>

</body>
</html>
